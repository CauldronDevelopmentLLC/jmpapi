#!/bin/bash -e

NAME=jmpapi
ETC=/etc/$NAME
RUN=/var/run/$NAME
LOG=/var/log/$NAME
CONFIG=$ETC/config.d/00-jmpapi

case "$1" in
    reconfigure|configure)
        # Install default config if one does not exist
        if [ ! -e $CONFIG ]; then
            ln -s /usr/share/doc/$NAME/$NAME.yaml $CONFIG
        fi

        # Setup permissions
        chown -R $NAME:root $ETC $RUN $LOG
        chmod u+rx,a-w $ETC $RUN $LOG

        if [ -x insserv ]; then
            # Install the init.d script
            insserv -d $NAME

            # Restart the service
            service $NAME start || true

        else
            # Install the init.d script
            update-rc.d $NAME defaults 95

            # Start the service
            invoke-rc.d $NAME start || true
        fi
        ;;
esac
